

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Writing Usage Examples &#8212; Developing with QIIME 2</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'plugins/how-to-guides/usage-examples';</script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Defining different Format validation levels" href="format-validation-levels.html" />
    <link rel="prev" title="How to test QIIME 2 plugins" href="test-plugins.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/q2dev.svg" class="logo__image only-light" alt="Developing with QIIME 2 - Home"/>
    <script>document.write(`<img src="../../_static/q2dev_darkmode.svg" class="logo__image only-dark" alt="Developing with QIIME 2 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Docs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../docs/user-documentation.html">Contributing to the QIIME 2 user documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/developer-documentation.html">Contributing to <em>Developing with QIIME 2</em></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Plugins</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/intro.html">Tutorials: Developing a QIIME 2 Plugin</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">How To Guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="set-up-development-environment.html">Set up your development environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="register-a-plugin.html">Register a QIIME 2 plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-register-method.html">Create and register a Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-register-visualizer.html">Create and register a visualizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-register-pipeline.html">Create and register a pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-register-transformer.html">Creating and registering a Transformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="artifact-collections-as-io.html">Use Artifact Collections as Action inputs or outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="play-nicely-with-others.html">How to play nicely with other plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="use-metadata.html">How to use Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="test-plugins.html">How to test QIIME 2 plugins</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Writing Usage Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="format-validation-levels.html">Defining different Format validation levels</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../explanations/intro.html">Explanations</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanations/actions.html">Types of QIIME 2 Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/types-of-types.html">Semantic types, data types, and file formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/transformers.html">Transformers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../references/intro.html">References</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../references/antipatterns.html">Plugin development anti-patterns</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Interfaces</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../interfaces/intro.html">Introduction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Framework Internals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../framework/intro.html">Introduction to QIIME 2 framework development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../framework/tutorials/intro.html">Tutorials</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../framework/how-to-guides/intro.html">How-to guides</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../framework/how-to-guides/parallel-configuration.html">Parallel configuration and usage in QIIME 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/how-to-guides/pipeline-resumption.html">Pipeline Resumption in QIIME 2</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../framework/explanations/intro.html">Explanations</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../framework/explanations/architecture.html">QIIME 2 architecture overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/explanations/data-storage.html">How Data is Stored</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/explanations/archives.html">Anatomy of an Archive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/explanations/types.html">Semantic Types, Primitives, and Visualizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/explanations/formats.html">File Formats and Directory Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/explanations/provenance.html">Decentralized retrospective provenance tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/explanations/garbage-collection.html">Garbage Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../framework/explanations/metaprogramming.html">Metaprogramming</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../framework/references/intro.html">References</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../framework/references/archive-versions.html">Archive versions</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">CI Internals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ci/intro.html">Introduction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Back Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../back-matter/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../back-matter/bibliography.html">List of works cited</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../back-matter/genindex.html">Index</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/plugins/how-to-guides/usage-examples.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Writing Usage Examples</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-factories-for-usage-examples">Data factories for usage examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-usage-examples">Defining usage examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#registering-usage-examples">Registering usage examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-usage-examples">Testing usage examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basking-in-the-glow-of-success">Basking in the glow of success</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comments-can-provide-context">Comments can provide context</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="writing-usage-examples">
<span id="how-to-write-usage-examples"></span><h1>Writing Usage Examples<a class="headerlink" href="#writing-usage-examples" title="Permalink to this heading">#</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This document is not yet formatted for <em>Developing with QIIME 2</em>.
Some links or references may not work.
If you run into issues, please let us know <a class="reference external" href="https://github.com/caporaso-lab/developing-with-qiime2/issues/36">here</a>.</p>
</div>
<p>Congratulations! You built a plugin, and now you want people to use it.
QIIME 2 provides a <span class="xref std std-doc">/api-reference/usage/index</span> you can use to give examples of
how plugin actions should be run.
It uses <a class="reference external" href="https://en.wikipedia.org/wiki/Dependency_injection">dependency injection</a>
to generate appropriate usage examples for any interface with a “usage driver”.
You define and register each usage example once,
giving it a parameter that accepts some usage driver.
The interface that is running your usage examples will inject one or more of its drivers
into your examples, rendering interface-appropriate results. Magic!</p>
<p>The API is defined by <a class="reference external" href="https://github.com/qiime2/qiime2/blob/39ac17da01e22057ff38197eb23ad6cca48f4c2e/qiime2/sdk/usage.py#L687">the Usage class</a>.
Individual usage drivers implement the underlying behavior of API functions according to their own needs.
As a result, the ExecutionUsage driver will attempt to execute your usage examples,
but will disregard <cite>comment</cite>s because it is not a user-facing driver.
The ArtifactAPIUsage driver will include your comments as python comments
in the rendered usage example, but will not execute your example.</p>
<p>The API is split into two sides -
one which allows plugin developers to define usage examples,
and one which allows interface developers to write the usage drivers that make those examples go.
<em>In this tutorial, we will focus exclusively on the plugin-developer facing usage example side of the API.</em></p>
<p><strong>In this tutorial, we will cover:</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#data-factories-for-usage-examples">Data factories for usage examples</a></p></li>
<li><p><a class="reference internal" href="#defining-usage-examples">Defining usage examples</a></p></li>
<li><p><a class="reference internal" href="#registering-usage-examples">Registering usage examples</a></p></li>
<li><p><a class="reference internal" href="#testing-usage-examples">Testing usage examples</a></p></li>
<li><p><a class="reference internal" href="#basking-in-the-glow-of-success">Basking in the glow of success</a></p></li>
<li><p><a class="reference internal" href="#comments-can-provide-context">Comments can provide context</a></p></li>
</ul>
<section id="data-factories-for-usage-examples">
<h2>Data factories for usage examples<a class="headerlink" href="#data-factories-for-usage-examples" title="Permalink to this heading">#</a></h2>
<p>Because some drivers actually execute these usage examples,
there is an expectation that we provide real data for them.
Simple assignment is not possible.
Inputs and Metadata must be created by a factory function.
This allows many drivers to avoid loading data unnecessarily.
Parameter literals may be passed directly, and do not require factories.</p>
<p>This example shows a factory function that returns a <code class="docutils literal notranslate"><span class="pre">FeatureTable[Frequency]</span></code>.
We use the Python 3 API to import a <code class="docutils literal notranslate"><span class="pre">biom.Table</span></code> with the appropriate Semantic Type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># from q2-feature-table/examples.py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">biom</span> <span class="kn">import</span> <span class="n">Table</span>

<span class="kn">from</span> <span class="nn">qiime2</span> <span class="kn">import</span> <span class="n">Artifact</span>


<span class="k">def</span> <span class="nf">ft1_factory</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Artifact</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span>
        <span class="s1">&#39;FeatureTable[Frequency]&#39;</span><span class="p">,</span>
        <span class="n">Table</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]),</span>
              <span class="p">[</span><span class="s1">&#39;O1&#39;</span><span class="p">,</span> <span class="s1">&#39;O2&#39;</span><span class="p">],</span>
              <span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="s1">&#39;S2&#39;</span><span class="p">,</span> <span class="s1">&#39;S3&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</section>
<section id="defining-usage-examples">
<h2>Defining usage examples<a class="headerlink" href="#defining-usage-examples" title="Permalink to this heading">#</a></h2>
<p>We’ve created some data, now we’ll define a usage example.
This is a simple python function with a single parameter (<code class="docutils literal notranslate"><span class="pre">use</span></code> by convention).
Interfaces pass their drivers to the example through <code class="docutils literal notranslate"><span class="pre">use</span></code> as described in the introduction.
The methods called inside of the function are “public” (non-underscore-prefixed) methods
defined in <code class="docutils literal notranslate"><span class="pre">qiime2.sdk.usage.Usage</span></code>.
This “Usage API” is common to all Usage drivers,
which reimplement the methods to meet their own needs.
Full details are available in the <span class="xref std std-doc">/api-reference/usage/index</span> reference.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># also from q2-feature-table/examples.py</span>
<span class="k">def</span> <span class="nf">feature_table_merge_example</span><span class="p">(</span><span class="n">use</span><span class="p">):</span>
    <span class="n">feature_table1</span> <span class="o">=</span> <span class="n">use</span><span class="o">.</span><span class="n">init_artifact</span><span class="p">(</span><span class="s1">&#39;feature_table1&#39;</span><span class="p">,</span> <span class="n">ft1_factory</span><span class="p">)</span>
    <span class="n">feature_table2</span> <span class="o">=</span> <span class="n">use</span><span class="o">.</span><span class="n">init_artifact</span><span class="p">(</span><span class="s1">&#39;feature_table2&#39;</span><span class="p">,</span> <span class="n">ft2_factory</span><span class="p">)</span>

    <span class="n">merged_table</span><span class="p">,</span> <span class="o">=</span> <span class="n">use</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
        <span class="n">use</span><span class="o">.</span><span class="n">UsageAction</span><span class="p">(</span><span class="n">plugin_id</span><span class="o">=</span><span class="s1">&#39;feature_table&#39;</span><span class="p">,</span>
                        <span class="n">action_id</span><span class="o">=</span><span class="s1">&#39;merge&#39;</span><span class="p">),</span>
        <span class="n">use</span><span class="o">.</span><span class="n">UsageInputs</span><span class="p">(</span><span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="n">feature_table1</span><span class="p">,</span> <span class="n">feature_table2</span><span class="p">]),</span>
        <span class="n">use</span><span class="o">.</span><span class="n">UsageOutputNames</span><span class="p">(</span><span class="n">merged_table</span><span class="o">=</span><span class="s1">&#39;merged_table&#39;</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>First, we initialize two feature tables.
(<code class="docutils literal notranslate"><span class="pre">ft2_factory</span></code> looks a lot like the <code class="docutils literal notranslate"><span class="pre">ft1_factory</span></code> defined above.
You’ll have to use your imagination on the details.)</p>
<p>We then use a proxy method for invoking an action.
The action may or may not <em>actually</em> be invoked,
depending on implementation details in the usage driver.
Beyond ensuring that your example is correct and meaningful,
you don’t have to worry about this.
<code class="docutils literal notranslate"><span class="pre">use.action</span></code> to your heart’s content, and let the interfaces handle their own business.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">UsageInputs</span></code> include both QIIME 2 <a class="reference internal" href="../../back-matter/glossary.html#term-Input"><span class="xref std std-term">Inputs</span></a> <em>and</em> <a class="reference internal" href="../../back-matter/glossary.html#term-Parameter"><span class="xref std std-term">parameters</span></a>.
Metadata must be initialized, but primitive parameters (and collections of parameters) may be passed directly.
There are examples of this in the <a class="reference external" href="https://github.com/qiime2/qiime2/blob/39ac17da01e22057ff38197eb23ad6cca48f4c2e/qiime2/core/testing/examples.py#L178">identity_with_metadata_column_get_mdc</a>
and <a class="reference external" href="https://github.com/qiime2/qiime2/blob/39ac17da01e22057ff38197eb23ad6cca48f4c2e/qiime2/core/testing/examples.py#L191">variadic_input_simple</a>
examples in the framework.</p>
</section>
<section id="registering-usage-examples">
<h2>Registering usage examples<a class="headerlink" href="#registering-usage-examples" title="Permalink to this heading">#</a></h2>
<p>Like QIIME 2 <a class="reference internal" href="../../back-matter/glossary.html#term-Action"><span class="xref std std-term">Actions</span></a>,
the usage examples we have defined must be registered in order to be used.</p>
<p>This registration occurs in <code class="docutils literal notranslate"><span class="pre">plugin_setup.py</span></code>,
in the <code class="docutils literal notranslate"><span class="pre">register_function</span></code> block for the Action whose usage we are showing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># from q2-feature-table/plugin_setup.py</span>

<span class="c1"># we need to import the examples to use them</span>
<span class="kn">from</span> <span class="nn">.examples</span> <span class="kn">import</span> <span class="p">(</span><span class="n">feature_table_merge_example</span><span class="p">,</span>
                       <span class="n">feature_table_merge_three_tables_example</span><span class="p">)</span>

<span class="n">plugin</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span>
    <span class="n">function</span><span class="o">=</span><span class="n">q2_feature_table</span><span class="o">.</span><span class="n">merge</span><span class="p">,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">i_table</span><span class="p">]},</span>

    <span class="c1"># Skipping ahead to the &#39;examples&#39; keyword argument</span>
    <span class="c1"># Everything else here should look familiar</span>
    <span class="o">...</span>

    <span class="n">examples</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;basic&#39;</span><span class="p">:</span> <span class="n">feature_table_merge_example</span><span class="p">,</span>
              <span class="s1">&#39;three_tables&#39;</span><span class="p">:</span> <span class="n">feature_table_merge_three_tables_example</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The keys in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> dictionary serve as unique identifiers for the examples themselves.
Some drivers (e.g. q2cli) use them to label rendered examples.</p>
</section>
<section id="testing-usage-examples">
<h2>Testing usage examples<a class="headerlink" href="#testing-usage-examples" title="Permalink to this heading">#</a></h2>
<p>You might be wondering how to confirm that your examples are working.
Great question!
Support for usage example testing is available via QIIME 2’s <cite>TestPluginBase.execute_examples()</cite>
and the <span class="xref std std-ref">results-and-assertions</span> exposed by the <code class="docutils literal notranslate"><span class="pre">UsageVariable</span></code> class
and optionally implemented in its driver-specific subclasses.</p>
<p>You can test your usage examples by making Semantic Type and file-contents assertions
about the UsageVariables returned by <code class="docutils literal notranslate"><span class="pre">use.action</span></code>.
These may be run by any usage driver that cares about them,
allowing both local smoke testing (“Can my examples be executed successfully?”),
and automated integration testing by interfaces like the QIIME 2 library.</p>
<p>Here, we assert that our results are of the expected type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">observed_features_example</span><span class="p">(</span><span class="n">use</span><span class="p">):</span>
    <span class="n">ft</span> <span class="o">=</span> <span class="n">use</span><span class="o">.</span><span class="n">init_artifact</span><span class="p">(</span><span class="s1">&#39;feature_table&#39;</span><span class="p">,</span> <span class="n">ft1_factory</span><span class="p">)</span>
    <span class="c1"># NOTE: we must unpack UsageVariables from the returned UsageOutputs</span>
    <span class="c1"># if we wish to use their assertion methods.</span>
    <span class="n">a_div_vector</span><span class="p">,</span> <span class="o">=</span> <span class="n">use</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
        <span class="n">use</span><span class="o">.</span><span class="n">UsageAction</span><span class="p">(</span><span class="n">plugin_id</span><span class="o">=</span><span class="s1">&#39;diversity_lib&#39;</span><span class="p">,</span>
                        <span class="n">action_id</span><span class="o">=</span><span class="s1">&#39;observed_features&#39;</span><span class="p">),</span>
        <span class="n">use</span><span class="o">.</span><span class="n">UsageInputs</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">ft</span><span class="p">),</span>
        <span class="n">use</span><span class="o">.</span><span class="n">UsageOutputNames</span><span class="p">(</span><span class="n">vector</span><span class="o">=</span><span class="s1">&#39;obs_feat_vector&#39;</span><span class="p">))</span>

    <span class="n">a_div_vector</span><span class="o">.</span><span class="n">assert_output_type</span><span class="p">(</span><span class="s1">&#39;SampleData[AlphaDiversity]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If we pass the Execution driver into this function, it will execute the example,
capturing actual Results.
By testing that our output is of the correct type, we can assert the type of the output
and in the process confirm that our example runs successfully with the given test data.</p>
<p>The easiest way to do this is with the <a class="reference external" href="https://github.com/qiime2/qiime2/blob/39ac17da01e22057ff38197eb23ad6cca48f4c2e/qiime2/plugin/testing.py#L253">execute_examples()</a>
method on <code class="docutils literal notranslate"><span class="pre">TestPluginBase</span></code>.
Including <a class="reference external" href="https://github.com/qiime2/q2-feature-table/blob/81852b2e4fdbe742191c9604e30a9a8cbd3aa708/q2_feature_table/tests/test_examples.py#L12">a test case that runs `execute_examples()</a>
in your unit tests allows you to smoke test them locally by running <cite>unittest</cite> or <cite>pytest</cite>.</p>
<p><strong>A note on scope:</strong></p>
<p>Usage assertions are intended to allow testing of usage drivers and examples,
and make it easy for developers to confirm that their <em>examples</em> work.
Dedicated unit tests provide much more flexilibity and power,
and are the preferred way to confirm that your computational <em>methods</em> work properly.</p>
<p>By adding the following to <code class="docutils literal notranslate"><span class="pre">observed_features_example</span></code>,
we <em>could</em> confirm that our test data produced exactly the expected results when executed,
but this hack is clunky, because it’s reaching beyond the intended use of this assertion.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sample_ids</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">exp</span><span class="p">:</span>
    <span class="n">a_div_vector</span><span class="o">.</span><span class="n">assert_has_line_matching</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="s1">&#39;alpha-diversity.tsv&#39;</span><span class="p">,</span>
        <span class="n">expression</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Asserting correct behavior of QIIME 2 Actions or their underlying python functions
will probably result in cleaner and more maintainable tests
than attempting to do the same using usage examples.</p>
</section>
<section id="basking-in-the-glow-of-success">
<h2>Basking in the glow of success<a class="headerlink" href="#basking-in-the-glow-of-success" title="Permalink to this heading">#</a></h2>
<p>Now that you’ve created and registered a usage example
and confirmed that it “works”, let’s see it in action!
We’ll pretend that we just wrote the <code class="docutils literal notranslate"><span class="pre">q2-feature-table</span></code> usage examples above.</p>
<ol class="arabic simple">
<li><p>Make sure your changes are present in the conda environment.
<code class="docutils literal notranslate"><span class="pre">q2-feature-table</span></code> is already installed in my QIIME 2 environment,
but the version in the environment came from the latest release, not my code.
To include my current changes, I can reinstall by running <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code>
from within the repository’s root directory.</p></li>
<li><p>Confirm my environment is using the right version.
Before re-installing, I called <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">list</span> <span class="pre">q2-feature-table</span></code>
to check what version of <code class="docutils literal notranslate"><span class="pre">q2-feature-table</span></code> was installed.
Re-running that command now, I see the version has changed,
indicating that my conda environment knows about the changes I made.</p></li>
<li><p>I’ll check things out first with <code class="docutils literal notranslate"><span class="pre">q2cli</span></code>, so I need to refresh the cache with
<code class="docutils literal notranslate"><span class="pre">qiime</span> <span class="pre">dev</span> <span class="pre">refresh-cache</span></code>.</p></li>
<li><p>Finally, I run the specific version of <code class="docutils literal notranslate"><span class="pre">qiime</span> <span class="pre">&lt;plugin</span> <span class="pre">name&gt;</span> <span class="pre">&lt;action&gt;</span> <span class="pre">--help</span></code>
that I’m curious about.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt;<span class="w"> </span>qiime<span class="w"> </span>feature-table<span class="w"> </span>merge<span class="w"> </span>--help
Usage:<span class="w"> </span>qiime<span class="w"> </span>feature-table<span class="w"> </span>merge<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>

<span class="w">    </span>Combines<span class="w"> </span>feature<span class="w"> </span>tables<span class="w"> </span>using<span class="w"> </span>the<span class="w"> </span><span class="sb">`</span>overlap_method<span class="sb">`</span><span class="w"> </span>provided.

...

Examples:
<span class="c1"># ### example: basic ###</span>
qiime<span class="w"> </span>feature-table<span class="w"> </span>merge<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--i-tables<span class="w"> </span>feature_table1.qza<span class="w"> </span>feature_table2.qza<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--o-merged-table<span class="w"> </span>merged_table.qza
<span class="c1"># ### example: three tables ###</span>
qiime<span class="w"> </span>feature-table<span class="w"> </span>merge<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--i-tables<span class="w"> </span>feature_table1.qza<span class="w"> </span>feature_table2.qza<span class="w"> </span>feature_table3.qza<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--p-overlap-method<span class="w"> </span>sum<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--o-merged-table<span class="w"> </span>merged_table.qza
</pre></div>
</div>
<p>Note that the unique identifiers we created during example definition and registration
(e.g. ‘feature_table1.qza’, ‘basic’ and ‘three tables’, and ‘merged_table’)
show up in our rendered example.
Note also that <code class="docutils literal notranslate"><span class="pre">q2cli</span></code>’s usage driver was clever enough to format the commands for <code class="docutils literal notranslate"><span class="pre">q2cli</span></code>,
including inferring that this action would produce a <code class="docutils literal notranslate"><span class="pre">.qza</span></code> file named <code class="docutils literal notranslate"><span class="pre">merged_table</span></code>.
Snazzy!</p>
<p>If we wanted to see what the Artifact API does with our examples,
we would confirm that our conda environment included our code (as above).
The cache is a q2cli thing, so we don’t need to refresh anything,
and we would render the examples manually.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">qiime2.plugins</span> <span class="kn">import</span> <span class="n">feature_table</span><span class="p">,</span> <span class="n">ArtifactAPIUsage</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get the examples</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">examples</span> <span class="o">=</span> <span class="n">feature_table</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">merge</span><span class="o">.</span><span class="n">examples</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">examples</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Create a usage driver instance</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">use</span> <span class="o">=</span> <span class="n">ArtifactAPIUsage</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># Inject the usage driver into the example, returning None</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">example</span><span class="p">(</span><span class="n">use</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1"># display the rendered example</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="nb">print</span><span class="p">(</span><span class="n">use</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>
</pre></div>
</div>
<p>Which renders the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiime2.plugins.feature_table.methods</span> <span class="kn">import</span> <span class="n">merge</span>

<span class="n">merged_table</span><span class="p">,</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span>
    <span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="n">feature_table1</span><span class="p">,</span> <span class="n">feature_table2</span><span class="p">],</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">qiime2.plugins.feature_table.methods</span> <span class="kn">import</span> <span class="n">merge</span>

<span class="n">merged_table</span><span class="p">,</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span>
    <span class="n">tables</span><span class="o">=</span><span class="p">[</span><span class="n">feature_table1</span><span class="p">,</span> <span class="n">feature_table2</span><span class="p">,</span> <span class="n">feature_table3</span><span class="p">],</span>
    <span class="n">overlap_method</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The outcome here shows how we might run the <code class="docutils literal notranslate"><span class="pre">merge</span></code> command in the Artifact API,
even including the correct import statement. WOOHOOO it works! you did a thing!</p>
</section>
<section id="comments-can-provide-context">
<h2>Comments can provide context<a class="headerlink" href="#comments-can-provide-context" title="Permalink to this heading">#</a></h2>
<p>For complex usage examples, you may want to provide additional context to the user.
<span class="xref std std-ref">usage-annotations</span> are available to help with this.
The linked documentation provides worked examples.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./plugins/how-to-guides"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="test-plugins.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">How to test QIIME 2 plugins</p>
      </div>
    </a>
    <a class="right-next"
       href="format-validation-levels.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Defining different Format validation levels</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-factories-for-usage-examples">Data factories for usage examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-usage-examples">Defining usage examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#registering-usage-examples">Registering usage examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-usage-examples">Testing usage examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basking-in-the-glow-of-success">Basking in the glow of success</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comments-can-provide-context">Comments can provide context</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Greg Caporaso and Evan Bolyen
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>